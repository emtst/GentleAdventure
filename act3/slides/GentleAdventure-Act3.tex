%\PassOptionsToPackage{dvipsnames}{xcolor}
\documentclass[xcolor={dvipsnames}]{beamer}

\usepackage[utf8]{inputenc}
%\usepackage[british]{babel}
%\usepackage{xcolor}
%\usepackage{tikz}
\usepackage{tkz-euclide}
\usepackage[normalem]{ulem}
\usepackage{amssymb}
\usepackage{pifont}
\usepackage{graphicx}
%\usepackage{minted}
%\usepackage{diagrams}
%\usepackage{multicol}
\usepackage[all]{xy}

%\usepackage{hyperref}
%\usepackage{minted}
%\usemintedstyle{tango}

\def\checkmark{\tikz\fill[scale=0.4](0,.35) -- (.25,0) -- (1,.7) -- (.25,.15) -- cycle;}

\title{A Gentle Adventure to Certify Multiparty Communication}
\subtitle{Act III}

%\author{Lorenzo Gheri}
%\institute{\normalsize Middlesex University, London}
%\date{27th September 2017}


\author{David Castro-Perez$^1$ \and Francisco Ferreira$^2$ \and \underline{Lorenzo Gheri$^2$} \and Nobuko Yoshida$^2$}

\institute{\textsuperscript{1} University of Kent \ \ \ \ \textsuperscript{2} Imperial College London
}
%\textsuperscript{1}Vrije Universiteit Amsterdam, Netherlands \and
%\textsuperscript{2}Max-Planck-Institut f\"ur Informatik, Germany\and
%\textsuperscript{3}Middlesex University London, UK
%\and
%\textsuperscript{4}MAIS, TU Darmstadt, Germany \and
%\textsuperscript{5}Institute of Mathematics Simion Stoilow of the Romanian Academy, Romania \and
%\textsuperscript{6}ETH~Z\"urich, Switzerland
%%Institute of Mathematics Simion Stoilow of the Romanian Academy, Bucharest, Romania
%}
%\date{Inria, CRI Rennes - Bretagne Atlantique\\ April 20, 2018}
\date{VEST'21 - 12th July 2021}

%\date[ITP 2017] % (optional)
%{ITP 2017\\
%Brasilia,
%26th-29th September 2017}


\input{act3macros}


\definecolor{MyGreen}{RGB}
%{34, 139, 34}
%{85, 107, 47}
%{19, 136, 8}
%{86, 130, 3}
{0,89,52}
\definecolor{MyPink}{RGB}
%{191, 118, 109} Isa
%{191, 123, 115}
%{191, 139, 109}
%{183, 139, 134} %guasi
%{191, 150, 145} %guasiguasi
{191, 163, 160}
%{252, 189, 236}
\definecolor{LightGray}{RGB}{211, 211, 211}
\definecolor{DarkGray}{RGB}{169, 169, 169}
%\newcommand\coll[1]{{\colorbox{light-gray}{$#1$}}}
\newcommand\coll[1]{\mbox{\colorbox{LightGray}{$\!#1\!$}}}
%\usecolortheme[named=MyGreen]{structure}
\usetheme{Copenhagen}
%\usecolortheme{seagull}
%\usecolortheme[named=green]{structure}
\setbeamercovered{invisible}
\setbeamercolor{structure}{fg=MyGreen}
%\setbeamercolor{title}{fg=MyPink}
%\setbeamercolor{frametitle}{fg=MyPink}
%\setbeamercolor{block title}{fg=MyPink}
%\setbeamercolor{titlelike}{fg=MyPink}
%\setbeamercolor{item projected}{fg=MyPink}
%\setbeamercolor{title in sidebar}{fg=MyPink}
\setbeamercolor{block body}{bg=MyPink}

%\include{comsdefs}
%\newcommand{\Iff}{\textsf{Iff}}
%\newcommand{\AND}{\mbox{\rm\textsf{AND}}}
%\newcommand{\ALL}{\mbox{\rm\textsf{ALL}}}
\newcommand{\gF}{\mbox{\rm\textsf{gF}}}
\newcommand{\gP}{\mbox{\rm\textsf{gP}}}
\newcommand{\gAND}{\mbox{\rm\textsf{gAND}}}
\newcommand{\gNOT}{\mbox{\rm\textsf{gNOT}}}
\newcommand{\gALL}{\mbox{\rm\textsf{gALL}}}
\newcommand{\gEQ}{\mbox{\rm\textsf{gEQ}}}
%\newcommand{\gt}{\mbox{gt}}
\newcommand{\gt}{\tilde{t}}
%\newcommand{\gphi}{\mathit{g\varphi}}
\newcommand{\gphi}{\tilde{\varphi}}
\newcommand{\formula}{\mbox{\bf formula}}
%\newcommand{\cmark}{\ding{51}}
%\newcommand{\xmark}{\ding{55}}
\setbeamertemplate{navigation symbols}{}
\newcommand{\Sym}{{\mathit{Sym}}}

\newcommand{\DD}{{\TC{D}}}
%\renewcommand{\DDD}{\mathcal{D}}
\newcommand{\DVars}{\mathsf{{DFVars}}}
\newcommand{\Dmap}{\mathsf{{Dmap}}}
\newcommand{\Pmap}{\mathsf{{Pmap}}}
\newcommand{\UUU}{\mathcal{U}}
\newcommand{\PPP}{\mathcal{P}}
\newcommand{\UVars}{\mathsf{{UFVars}}}
\newcommand{\Umap}{\mathsf{{Umap}}}
\newcommand{\Uctor}{\mathsf{{Uctor}}}
\newcommand{\Udtor}{\mathsf{{Udtor}}}
\newcommand{\pu}{\mathit{pu}}

\definecolor{mine}{RGB}{10,127,87}


\newcommand{\high}[1]{\textcolor{blue}{#1}}
\newcommand{\bad}[1]{\textcolor{red}{#1}}
\newcommand{\gray}[1]{\textcolor{gray}{#1}}
\newcommand{\blue}[1]{\textcolor{blue}{#1}}
\newcommand{\green}[1]{{\textcolor{mine}{#1}}}
\newcommand{\black}[1]{\textcolor{black}{#1}}
\newcommand{\brown}[1]{\textcolor{brown}{#1}}
\newcommand{\white}[1]{\textcolor{white}{#1}}
\newcommand{\red}[1]{\textcolor{red}{#1}}
\newcommand{\typeT}{{\TC{Type}}}
\newcommand{\pat}{{\TC{Pattern}}}
\newcommand{\brownNR}[2]{#1^{\brown{@ #2}}}
\newcommand{\fpfunT}{{\TC{FinPFunc}}}
%\newcommand{\recordt}{{\TC{Record}}}
%\newcommand{\typet}{{\TC{Type}}}
\newcommand{\termt}{{\TC{Term}}}

\newcommand{\Ap}{\mathsf{Ap}}
\newcommand{\Trm}{\mathsf{Trm}}
\newcommand{\Vari}{\mathsf{Vr}}
%\newcommand{\Lam}{\mathsf{{Lm}}}
%\newcommand{\Lm}{\mathsf{{Lm}}}
\newcommand{\Vr}{\mathsf{{Vr}}}
%\newcommand{\Var}{\mathsf{{Var}}}
\newcommand{\sw}{\!\wedge\!}
\newcommand{\Perm}{\mathsf{{Perm}}}
\newcommand{\Bool}{{\TC Bool}}
\newcommand{\ddepth}{{{\mathsf{depth}}}}
\newcommand{\purple}[1]{{\color{purple} #1}}
\newcommand{\orange}[1]{{\color{orange} #1}}
\newcommand{\len}{\mathsf{{len}}}
%\renewcommand{\Set}{\TC{{Set}}}


\begin{document}

\begin{frame}
	\maketitle
%	\begin{flushright}
%	\begin{tiny}
%	I got the poison, I got the remedy...
%	\end{tiny}
%	\end{flushright}
\end{frame}
%
%





\begin{frame}{The Multiparty Session Types World, as We Know It}


\begin{figure}
\begin{tikzpicture}
    [x=1.1cm, y=-1.5cm, align=center, font=\normalsize, draw,
    every node/.style={minimum width=1.8cm}]+
		\node [] (G) at (0,0) {$\G$};
		\node [] (L1) at (-1.5,.8 ) {$\dlt{\lT_1}$};
		\node [] (L2) at (-.50,.8 ) {$\dlt{\lT_2}$};
		\node [] (LL) at (.50 ,.8 ) {$\dlt{\dots}$};
		\node [] (Ln) at ( 1.5,.8 ) {$\dlt{\lT_n}$};
		\node [] (P1) at (-1.5,1.6) {$\dproc{\proc_1}$};
		\node [] (P2) at (-.50,1.6) {$\dproc{\proc_2}$};
		\node [] (PP) at ( .50,1.6) {$\dots$};
		\node [] (Pn) at ( 1.5,1.6) {$\dproc{\proc_n}$};
		\draw [->] (G.south) to (L1);
		\draw [->] (G.south) to (L2);
		\draw [->, dashed] (G.south) to (LL);
		\draw [->] (G.south) to (Ln);
		\draw [->] (L1) to (P1);
		\draw [->] (L2) to (P2);
		\draw [->, dashed] (LL) to (PP);
		\draw [->] (Ln) to (Pn);
	    \node  at (-2,0.4) {\small projection ($\upharpoonright$)};
	    \node  at (-2.4,1.2) {\small  typing ($\ofLt$)};
	\end{tikzpicture}
\end{figure}


\end{frame}


\begin{frame}{Zooid}

  \begin{figure}
\input{thediagram.tex}
\end{figure}

\end{frame}





\begin{frame}{Metatheory of Zooid Multiparty Session Types}

\begin{figure}
\begin{tikzpicture}[commutative diagrams/every diagram]


	\node(G0)at (0,0) {$\G$};
	\node(G1)at (3,0) {$\coG$};
	\node(G2)at (6,0) {\small{global trace}};
	\node(L0)at (0,-1.5) {$\lT$};
	\node(L1)at (3,-1.5) {$\colT$};
	\node(L2)at (6,-1.5) {\small{local trace}};


	\path[commutative diagrams/.cd,every arrow,font=\scriptsize]
	(G0) edge node[above] {$\Re$} (G1)
	(G1) edge node[above] {LTS} (G2)
	(L0) edge node[above] {$\Re$} (L1)
	(L1) edge node[above] {LTS} (L2)
	(G0) edge node[right] {$\upharpoonright$} (L0)
	(G1) edge node[right] {$\upharpoonright^{\textsf{c}}$} (L1)
	(G2) edge[<->] node[right] {$=$} (L2)

	;



\end{tikzpicture}
\end{figure}

\end{frame}



\begin{frame}{Formalisation of Global and Local Types}
\begin{small}
\begin{columns}
\begin{column}{0.5\textwidth}

  Inductively defined datatypes
  \[
  \begin{array}{ll}
    %\tS & ::= \tnat \SEP \tint \SEP\tbool \SEP \tplus \tS \tS \SEP \tpair \tS \tS \\
    \G & ::= \gend \;\\
    &\SEP\; \gX \;\\
    &\SEP\;\grec \gX \G \;\\%
    &\SEP\;\msg \p\q {\dgt{(\tS).}} {\G}\\[4mm]%
    \lT & := \lend\;\\
    &\SEP\;\lX \;\\
    &\SEP\;\lrec \lX \lT\;\\
    &\SEP\;  \lsnd \q {\dlt{(\tS).}} {\lT}\;\\
    &\SEP\; \lrcv \p  {\dlt{(\tS).}} {\lT}
  \end{array}
\]


\end{column}
\begin{column}{0.5\textwidth}
  Coinductively defined datatypes
  \[
  \begin{array}{ll}
    \coG ::=\;&\cogend \;\\
    &\SEP\;\comsgn \p\q  {\dcog{(\tS).}} {\coG}\;\\
    &\SEP\;\comsgs \p\q {\ } {\dcog{(\tS).}} {\coG}
  \end{array}
  \]

\vspace{4mm}

    \[
    \begin{array}{ll}
      \colT ::= & \colend\;\\
      &\SEP\;\colsnd \p {\dcol{(\tS).}} {\colT}\\
      &\SEP\;\colrcv \q {\dcol{(\tS).}} {\colT}
    \end{array}
  \]
\end{column}




\end{columns}
\end{small}
\end{frame}


\begin{frame}{Formalisation of Global and Local Types}
\begin{small}

  \begin{columns}

  \begin{column}{0.5\textwidth}  %%<--- here
  \[
  \G = \grec \gX {\msg \p\q {(\tS).} \gX}
  \]
  \vspace{8mm}
  \[
  \begin{array}{l}
    \proj \G p = \lrec \lX {\lsnd q {(\tS).} \lX}\\
    \proj \G q = \lrec \lX {\lrcv p {(\tS).} \lX}
  \end{array}
  \]
\end{column}


\begin{column}{0.5\textwidth}  %%<--- here
  \[
  \coG = \comsgn \p \q {\dcog{(\tS).}} {\coG}
  \]
  \[
  \begin{array}{l}
    \dcol{\colT_\p} =  \colsnd \q {(\tS).} \dcol{\colT_\p}\\
    \dcol{\colT_\q} = \colrcv \p {(\tS).} \dcol{\colT_\q}\\
    \text{with } \coproj \p \coG \dcol{\colT_\p}\\
    \text{and }  \coproj \q \coG \dcol{\colT_\q}
  \end{array}
  \]


\end{column}
\end{columns}

  \end{small}
\end{frame}


%% \begin{frame}{Coinductive Global and Local ``Trees''}
%%   \begin{columns}
%% \begin{column}{0.5\textwidth}
%%   \[
%%   \coG ::=\; %
%%   \cogend \;\SEP\;%
%%   \comsgn \p\q  {\dcog{(\tS).}} {\coG}
%%   \]
%%   \vspace{-4mm}
%%   \[
%%     \begin{array}{ll}
%%     \preG  ::= & \pgend\ \coG \;\\
%%     &\SEP\;\pmsgn \p\q {\dpre{(\tS)}} {\preG}\\
%%     &\SEP\; \pmsgs  \p\q {\ } {\dpre{(\tS)}} {\preG}
%%     \end{array}
%%   \]
%% \vspace{4mm}

%%     \[
%%     \begin{array}{ll}
%%       \colT ::= & \colend\;\\
%%       &\SEP\;\colsnd \p {\dcol{(\tS).}} {\colT}\\
%%       &\SEP\;\colrcv \q {\dcol{(\tS).}} {\colT}
%%     \end{array}
%%   \]
%% \end{column}
%% \begin{column}{0.6\textwidth}  %%<--- here
%%   Inductive prefixes for global ``trees'' $\preG$ are formally introduced for asynchronicity!

%%     \[
%%   \pmsgn \p\q {\dpre{(\tS)}} {\preG} \step \pmsgs  \p\q {\ } {\dpre{(\tS)}} {\preG}
%%   \]
%% \end{column}
%% \end{columns}
%% \end{frame}




\begin{frame}{Abandoning Inductive Datatypes}
 \begin{small}
  \begin{theorem}[Unravelling preserves projections]
    Given $\G$, $\lT$, $\coG$ and $\colT$, such that $(a)$ $\projt{\G} \pr = \lT\ $, $(b)$ $\gunroll \G \coG$, and $(c)$ $\lunroll \lT \colT$,
then $\coproj \pr \coG \colT$.
  \end{theorem}


  \begin{figure}
\begin{tikzpicture}[commutative diagrams/every diagram]


	\node(G0)at (0,0) {$\G$};
	\node(G1)at (3,0) {$\coG$};
	%\node(G2)at (6,0) {\small{global trace}};
	\node(L0)at (0,-1.5) {$\lT$};
	\node(L1)at (3,-1.5) {$\colT$};
	%\node(L2)at (6,-1.5) {\small{local trace}};


	\path[commutative diagrams/.cd,every arrow,font=\scriptsize]
	(G0) edge node[above] {$\Re$} (G1)
	%(G1) edge node[above] {LTS} (G2)
	(L0) edge node[above] {$\Re$} (L1)
	%(L1) edge node[above] {LTS} (L2)
	(G0) edge node[right] {$\upharpoonright$} (L0)
	(G1) edge node[right] {$\upharpoonright^{\textsf{c}}$} (L1)
	%(G2) edge[<->] node[right] {$=$} (L2)

	;

\end{tikzpicture}
  \end{figure}

        \begin{proof}
          By coinduction. :)
        \end{proof}
\end{small}
\end{frame}

\begin{frame}{Type Semantics for Zooid}

\begin{figure}
\begin{tikzpicture}[commutative diagrams/every diagram]


	%\node(G0)at (0,0) {$\G$};
	\node(G1)at (3,0) {$\coG$};
	\node(G2)at (6,0) {\small{global trace}};
	%\node(L0)at (0,-1.5) {$\lT$};
	\node(L1)at (3,-1.5) {$\colT$};
	\node(L2)at (6,-1.5) {\small{local trace}};


	\path[commutative diagrams/.cd,every arrow,font=\scriptsize]
	%(G0) edge node[above] {$\Re$} (G1)
	(G1) edge node[above] {LTS} (G2)
	%(L0) edge node[above] {$\Re$} (L1)
	(L1) edge node[above] {LTS} (L2)
	%(G0) edge node[right] {$\upharpoonright$} (L0)
	(G1) edge node[right] {$\upharpoonright^{\textsf{c}}$} (L1)
	(G2) edge[<->] node[right] {$=$} (L2)

	;



\end{tikzpicture}
\end{figure}

\end{frame}


\begin{frame}[fragile]{With Love, from $\p$ to $\q$}

\begin{footnotesize}

$\p$ sends:
\[
\begin{tikzcd}[ampersand replacement=\&]
\comsgn \p\q \dcog{ (S).} \coG \arrow[rr, "!\p\q\tS "]\arrow[dd,"\upharpoonright_{\p}"]
\& \&
\comsgs \p\q {\ } \dcog{ (S).} {\coG}\arrow[rr, "?\q\p\tS "]\arrow[rrdd, "\upharpoonright_{\p}"]
\& \&
\coG\arrow[dd, "\upharpoonright_{\p}"] \\
\& \& \& \&\\
\colsnd \q \dcol{ (S).} \colT \arrow[rrrr, "!\p\q\tS"]\& \& \& \&\colT
\end{tikzcd}
\]
\ \\
\ \\
\ \\
%\visible<2->{
$\q$ receives:
\[
\begin{tikzcd}[ampersand replacement=\&]
\comsgn \p\q \dcog{ (S).} {\coG} \arrow[rr, "!\p\q\tS "]\arrow[dd,"\upharpoonright_{\q}"]
\& \&
\comsgs \p\q {\ } \dcog{ (S).} {\coG}\arrow[rr, "?\q\p\tS "]\arrow[lldd, "\upharpoonright_{\q}"]
\& \&
\coG\arrow[dd, "\upharpoonright_{\q}"] \\
\& \& \& \&\\
\colrcv \p \dcol{ (S).} \colT\dcol{'} \arrow[rrrr, "?\q\p\tS"]\& \& \& \&\colT\dcol{'}
\end{tikzcd}
\]
%}
\end{footnotesize}


\end{frame}

\begin{frame}[fragile]{Tools for our LTS}
\begin{small}
  {\bf Actions.} $!\p\q\tS$ and $?\q\p\tS$\\ \ \\
  {\bf (Local) Environments.} $E$ such that, $E(\p)=\dcol{\colT_\p}$ where $\coproj \p \coG \dcol{\colT_\p}$\\ \ \\
  {\bf Queues and Queue Environments.} $Q$, buffers for asynchronous communication.
\[
\begin{tikzcd}[ampersand replacement=\&]
\colsnd \q \dcol{(S).} \colT \arrow[rr, "\text{step}"]\& \&\colT\&\&\\[-5mm]
Q(\p,\q)=[]\arrow[rr,"\text{enqueue}"] \& \& Q(\p,\q)=[S]\arrow[rr,"\text{dequeue}"] \& \& Q(\p,\q)=[]\\[-5mm]
\& \& \colrcv \p  \dcol{(S).} \colT{\color{dkolive}'}  \arrow[rr, "\text{step}"]\& \& \colT{\color{dkolive}'}
\end{tikzcd}
\]
\visible<2->{
\begin{block}{}
\[
\begin{tikzcd}[ampersand replacement=\&]
\&\coG\arrow[dl,"{\pmb\upharpoonright}^{\sf c}"]\arrow[dr,"{\pmb\upharpoonright}^{\sf q}"']\&\&\&\coG\arrow[d, "{\pmb\upharpoonright}\!{\pmb\upharpoonright}"]\\
\dcol{E}\& \&Q\&\&(\dcol{E},Q)
\end{tikzcd}
\]
\end{block}
}
\end{small}
\end{frame}


\begin{frame}{Theorems}
\begin{small}
\begin{Theorem}[Step Soundness]
   If $\coG \stepa{a} \dcog{\coG'}$ and $\coG \osproj (\dcol{E},Q)$,
   there exist $\dcol{E'}$ and $Q'$ such that
   $\dcog{\coG'} \osproj (\dcol{E'},Q')$ and
   $(\dcol{E},Q) \stepa{a} (\dcol{E'},Q')$.
 \end{Theorem}
\vspace{3mm}
\begin{Theorem}[Step Completeness]
  If $(\dcol{E},Q) \stepa{a} (\dcol{E'},Q')$ and
  $\coG \osproj (\dcol{E},Q)$, there exist $\dcog{\coG'}$ such that
  $\dcog{\coG'} \osproj (\dcol{E'},Q')$ and
  $\coG \stepa{a} \dcog{\coG'}$.
\end{Theorem}
\vspace{3mm}
\begin{theorem}[Trace equivalence]
  If $\coG\osproj(\dcol{E},Q)$, then
$\ \glts t \coG\ $
if and only if $\ \llts t (\dcol{E},Q)\ $.
\end{theorem}


\end{small}
\end{frame}

\begin{frame}{Lemma, to give the flavour}

$\longrightarrow$ Coq!

\end{frame}

\begin{frame}{Our Adventurer Rests and Meditates}

  \begin{small}

    \begin{itemize}
    \item Formal proofs are not easy! (But useful and fun!)
    \item Proof design is the key.
    \item Proof techniques are to be taken seriously: (co)induction, functions VS relations...
    \end{itemize}

  \end{small}


  \visible<2->{
  \begin{center}
      \includegraphics[width=0.35\textwidth]{napalm.jpg}


\begin{footnotesize}
\emph{``You need to stay focused. Otherwise you miss the subtleties!''} \footnote<2->{\tiny Barney Greenway (Napalm Death), after suprising the audience with a blitz performance of ``You Suffer''.}
\end{footnotesize}
  \end{center}

}
\end{frame}
\begin{frame}

  \begin{center}
    Thank You!
  \end{center}

\end{frame}

\end{document}\grid
